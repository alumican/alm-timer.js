{"version":3,"file":"index.js","sources":["../src/TimerEvent.ts","../src/Timer.ts"],"sourcesContent":["export enum TimerEventType {\n\ttick = 'tick',\n\tcomplete = 'complete',\n}\n\nexport interface TimerEventDetail {\n\telapsedCount:number;\n\trepeatCount:number;\n\trestCount:number;\n}\n\nexport class TimerEvent extends CustomEvent<TimerEventDetail> {\n\tconstructor(type:TimerEventType, options:CustomEventInit<TimerEventDetail>) {\n\t\tsuper(type, options);\n\t}\n}\n","import {TimerEvent, TimerEventType} from \"./TimerEvent\";\nimport {DateUtil} from \"alm\";\n\nexport class Timer extends EventTarget {\n\n\t// --------------------------------------------------\n\t//\n\t// CONSTRUCTOR\n\t//\n\t// --------------------------------------------------\n\n\tconstructor(interval:number = 1000, repeatCount:number = 0) {\n\t\tsuper();\n\t\tthis.interval = interval;\n\t\tthis.repeatCount = repeatCount;\n\t\tthis.isRunning = false;\n\t\tthis.tId = -1;\n\t\tthis.reset();\n\t\tDateUtil.now();\n\t}\n\n\n\n\n\n\t// --------------------------------------------------\n\t//\n\t// METHOD\n\t//\n\t// --------------------------------------------------\n\n\tpublic start():void {\n\t\tif (this.isRunning) return;\n\t\tthis.isRunning = true;\n\t\tthis.tStartTime = DateUtil.now();\n\t\tthis.startInterval(this.tRestTime !== -1 ? this.tRestTime : this.interval);\n\t}\n\n\tpublic stop():void {\n\t\tif (!this.isRunning) return;\n\t\tthis.isRunning = false;\n\t\tthis.tRestTime = DateUtil.now() - this.tStartTime;\n\t\tthis.stopInterval();\n\t}\n\n\tpublic reset():void {\n\t\tthis.stop();\n\t\tthis.elapsedCount = 0;\n\t\tthis.tRestTime = -1;\n\t}\n\n\tpublic restart():void {\n\t\tthis.reset();\n\t\tthis.start();\n\t}\n\n\n\n\n\n\tprivate startInterval(interval:number):void {\n\t\tthis.stopInterval();\n\t\tthis.tInterval = interval;\n\t\tthis.tId = window.setInterval(this.timerHandler, this.tInterval);\n\t}\n\n\tprivate stopInterval():void {\n\t\tif (this.tId !== -1) {\n\t\t\tclearInterval(this.tId);\n\t\t\tthis.tId = -1;\n\t\t}\n\t}\n\n\tprivate dispatch(eventType:TimerEventType):void {\n\t\tthis.dispatchEvent(new TimerEvent(eventType, { detail: {\n\t\t\t\telapsedCount: this.elapsedCount,\n\t\t\t\trepeatCount: this.repeatCount,\n\t\t\t\trestCount: this.getRestCount(),\n\t\t\t}}));\n\t}\n\n\tprivate timerHandler = ():void => {\n\t\tthis.tStartTime = DateUtil.now();\n\t\t++this.elapsedCount;\n\t\tlet isCompleted:boolean = false;\n\t\tif (this.repeatCount > 0 && this.elapsedCount >= this.repeatCount) {\n\t\t\tisCompleted = true;\n\t\t\tthis.stop();\n\t\t} else if (this.tInterval !== this.interval) {\n\t\t\tthis.startInterval(this.interval);\n\t\t}\n\t\tthis.dispatch(TimerEventType.tick);\n\t\tif (isCompleted) {\n\t\t\tthis.dispatch(TimerEventType.complete);\n\t\t}\n\t};\n\n\n\n\n\n\tpublic getIsRunning():boolean {\n\t\treturn this.isRunning;\n\t}\n\n\tpublic getInterval():number {\n\t\treturn this.interval;\n\t}\n\n\tpublic setInterval(interval:number):void {\n\t\tthis.interval = interval;\n\t}\n\n\tpublic getElapsedTime():number {\n\t\treturn DateUtil.now() - this.tStartTime;\n\t}\n\n\tpublic getRestTime():number {\n\t\treturn this.interval - this.getElapsedTime();\n\t}\n\n\tpublic getElapsedCount():number {\n\t\treturn this.elapsedCount;\n\t}\n\n\tpublic getRepeatCount():number {\n\t\treturn this.repeatCount;\n\t}\n\n\tpublic setRepeatCount(count:number):void {\n\t\tthis.repeatCount = count;\n\t}\n\n\tpublic getRestCount():number {\n\t\treturn this.repeatCount - this.elapsedCount;\n\t}\n\n\n\n\n\n\t// --------------------------------------------------\n\t//\n\t// MEMBER\n\t//\n\t// --------------------------------------------------\n\n\tprivate isRunning:boolean;\n\tprivate interval:number;\n\tprivate elapsedCount:number;\n\tprivate repeatCount:number;\n\tprivate tStartTime:number;\n\tprivate tRestTime:number;\n\tprivate tInterval:number;\n\tprivate tId:number;\n}\n"],"names":["TimerEventType","DateUtil"],"mappings":"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"}